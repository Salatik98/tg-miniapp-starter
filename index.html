<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Telegram Mini App ‚Ä¢ Starter</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root { --pad: 16px; }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Noto Sans', sans-serif;
      margin: 0; padding: var(--pad);
      background: #ffffff; color: #111111;
    }
    h1 { margin: 0 0 8px 0; font-weight: 700; }
    .card {
      border-radius: 16px; padding: 16px; margin: 12px 0;
      box-shadow: 0 1px 4px rgba(0,0,0,.08);
      background: rgba(255,255,255,.8);
      backdrop-filter: blur(2px);
    }
    button {
      padding: 12px 16px; border: 0; border-radius: 10px;
      font-size: 16px; cursor: pointer; margin-right: 8px; margin-bottom: 8px;
    }
    pre {
      white-space: pre-wrap; word-break: break-word; margin: 0;
      font: 13px/1.4 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace;
      background: #f5f5f5; padding: 8px; border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>–ü—Ä–∏–≤–µ—Ç –∏–∑ –º–∏–Ω–∏‚Äë–∞–ø–ø–∞ üëã</h1>
  <div id="tg-warning" class="card" style="display:none">
    –û—Ç–∫—Ä–æ–π —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ Telegram, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  </div>

  <div id="user" class="card"></div>

  <div class="card">
    <button id="btn-main">–ü–æ–∫–∞–∑–∞—Ç—å Main Button</button>
    <button id="btn-haptic">Haptic feedback</button>
  </div>

  <div id="debug" class="card">
    <strong>initData (debug):</strong>
    <pre id="initData"></pre>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;

    function renderUser(u){
      const el = document.getElementById('user');
      if(!u){
        el.innerHTML = "<em>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω. –û—Ç–∫—Ä–æ–π —á–µ—Ä–µ–∑ Telegram.</em>";
        return;
      }
      const name = [u.first_name, u.last_name].filter(Boolean).join(' ');
      el.innerHTML = \`
        <div><strong>–ò–º—è:</strong> \${name || '‚Äî'}</div>
        <div><strong>@username:</strong> \${u.username ? '@'+u.username : '‚Äî'}</div>
        <div><strong>ID:</strong> \${u.id}</div>
        <div><strong>–Ø–∑—ã–∫:</strong> \${u.language_code || '‚Äî'}</div>
      \`;
    }

    if(!tg){
      document.getElementById('tg-warning').style.display = 'block';
    }else{
      tg.ready();
      tg.expand(); // –∑–∞–Ω–∏–º–∞–µ–º –ø–æ–±–æ–ª—å—à–µ –≤—ã—Å–æ—Ç—ã

      // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Ç–µ–º—É (–µ—Å–ª–∏ –≤ –¢–µ–ª–µ–≥–µ —Ç—ë–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è)
      document.body.style.background = tg.themeParams.bg_color || '#fff';
      document.body.style.color = tg.themeParams.text_color || '#111';

      const user = tg.initDataUnsafe?.user;
      renderUser(user);

      document.getElementById('initData').textContent = tg.initData || '(–ø—É—Å—Ç–æ)';

      // Main Button demo
      const btnMain = document.getElementById('btn-main');
      btnMain.addEventListener('click', () => {
        if (tg.MainButton.isVisible){
          tg.MainButton.hide();
          btnMain.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å Main Button';
        } else {
          tg.MainButton.setText('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É');
          tg.MainButton.onClick(() => {
            const payload = JSON.stringify({action:'demo_submit', user_id: user?.id || null});
            tg.sendData(payload); // –±–æ—Ç –ø–æ–ª—É—á–∏—Ç web_app_data
            tg.close(); // –∑–∞–∫—Ä–æ–µ–º webapp
          });
          tg.MainButton.show();
          btnMain.textContent = '–°–ø—Ä—è—Ç–∞—Ç—å Main Button';
        }
      });

      // Haptic feedback
      document.getElementById('btn-haptic').addEventListener('click', () => {
        try{ tg.HapticFeedback.impactOccurred('medium'); }catch(e){}
      });
    }
  </script>
</body>
</html>
